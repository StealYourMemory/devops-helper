import{g as F,a as P,f as H,_ as Q,b as X,c as Z,d as ee,e as le,h as te,i as ae,j as oe}from"./byteFormatter-CuudNSZ-.js";import{d as E,j as g,s as O,E as v,r as i,o as r,c as N,a as d,f as t,w as o,g as f,m as V,J as se,z as x,K as ne,t as A,L as re,F as C,A as ie,x as ce,n as R,C as ue,l as U,p as de,h as _e,_ as me}from"./index-B8KVQuq1.js";import{t as pe}from"./time-DxmJvrj7.js";import{g as fe,b as ge,c as ve}from"./projectApi-DNyIEPDE.js";import{p as M,a as he,b as W,L as T,n as S,t as be,l as ye}from"./projectWeight-D633_mfl.js";import{L as we}from"./LoadingIcon-BIsLc0kW.js";import{s as je}from"./sleeep-DLQXQLPT.js";import{a as ke,b as xe,h as Ne}from"./BuildAndDeployProgress.vue_vue_type_style_index_0_lang-Dx6VpVzU.js";import"./axios-CEz4Hwn_.js";const Le={key:0},Be={key:1,style:{"font-size":"medium","margin-left":"20px"}},Ve={style:{"font-size":"medium"}},$e={style:{"margin-left":"auto","margin-right":"10%",display:"flex"}},De={key:0,style:{"margin-right":"60px"}},ze={style:{"font-size":"small"}},Ie={style:{"font-size":"small"}},y=28,Ae=E({__name:"SeafilePage",setup(L){const e={label:"name",children:"children",isLeaf:"isLeaf"},D=g(null);let m="";O(async()=>{const s=await F();s.success?m=s.data:v.error(s.msg);const c=await P(m);c.success?D.value=c.data:v.error(c.msg)});const k=async(s,c)=>{const a=await F();a.success?m=a.data:v.error(a.msg),P(p(s)).then(l=>{l.success&&l.data&&c(l.data)})};function p(s){if(s.level===0)return m;{const c=[];for(;s&&s.label;)c.unshift(s.label),s=s.parent;let a="";return c.forEach(l=>{a+=`/${l}`}),m+a}}const w=g(!1),j=g(""),B=g("");async function z(s,c){if(c.size!=null&&Number(c.size)>10*1024*1024){v.warning("文件大于10MB，可能不是文本文件，不能查看");return}const a=ie.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),l=await X(p(s));a.close(),l.success?(B.value=s.label.split(".")[1],j.value=l.data,w.value=!0):v.error(l.msg)}return(s,c)=>{const a=i("el-icon"),l=i("el-button"),h=i("el-tree"),_=i("el-dialog");return r(),N(C,null,[d("div",null,[t(h,{props:e,load:k,lazy:""},{default:o(({node:b,data:n})=>[d("div",null,[!b.expanded&&!n.isLeaf?(r(),f(a,{key:0,size:20},{default:o(()=>[t(V(se))]),_:1})):x("",!0),b.expanded&&!n.isLeaf?(r(),f(a,{key:1,size:20},{default:o(()=>[t(V(ne))]),_:1})):x("",!0)]),n.isLeaf?(r(),N("div",Le,[n.name.endsWith(".yaml")||n.name.endsWith(".yml")?(r(),f(Z,{key:0,width:y,height:y})):n.name.endsWith(".sql")?(r(),f(ee,{key:1,width:y,height:y})):n.name.endsWith(".sh")?(r(),f(le,{key:2,width:y,height:y})):n.name.endsWith(".txt")?(r(),f(te,{key:3,width:y,height:y})):(r(),f(ae,{key:4,width:y,height:y}))])):x("",!0),n.isLeaf?x("",!0):(r(),N("span",Be,A(n.name),1)),n.isLeaf?(r(),f(l,{key:2,text:"",size:"small",onClick:I=>z(b,n)},{default:o(()=>[d("span",Ve,A(n.name),1)]),_:2},1032,["onClick"])):x("",!0),d("div",$e,[n.isLeaf?(r(),N("div",De,[d("span",ze,A(V(H)(n.size)),1)])):x("",!0),d("div",null,[t(a,null,{default:o(()=>[t(V(re))]),_:1}),d("span",Ie,A(V(pe)(n.time*1e3)),1)])])]),_:1})]),t(_,{modelValue:w.value,"onUpdate:modelValue":c[0]||(c[0]=b=>w.value=b),center:"",draggable:"","destroy-on-close":"",width:"80%"},{default:o(()=>[t(Q,{content:j.value,"file-type":B.value},null,8,["content","file-type"])]),_:1},8,["modelValue"])],64)}}}),$=L=>(de("data-v-6043e987"),L=L(),_e(),L),Re=$(()=>d("h4",{style:{display:"inline-block","margin-right":"5%"}},"打包并更新到seafile",-1)),Ce=$(()=>d("br",null,null,-1)),Te=$(()=>d("br",null,null,-1)),Se=$(()=>d("br",null,null,-1)),Ee=$(()=>d("svg",{class:"circular",viewBox:"0 0 50 50"},[d("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)),Fe={style:{display:"flex","justify-content":"flex-end","margin-right":"10px","margin-top":"40px"}},Pe=$(()=>d("span",null,"打包更新",-1)),Ue=E({__name:"BuildAndTransfer",setup(L){const e=g({projectName:"",branch:"",tag:"",updateInfo:""}),D=g(ke),m=g(),k=g([]);O(async()=>{const a=await fe();if(a.success){const l=a.data.map(h=>({label:h.projectName,value:h.projectName,disabled:h.disabled}));M(l),k.value=l}else v.error(a.msg)});const p=g([]),w=g(!1);let j=0;async function B(){if(Date.now()-j>W||p.value.length===0){w.value=!0;const a=await ge(e.value.projectName);w.value=!1,j=Date.now(),a.success?p.value=a.data.branches.map(l=>({label:l,value:l})):v.error(a.msg)}}function z(a,l){e.value.projectName!=null&&e.value.projectName.length!=0&&e.value.branch!=null&&e.value.branch.length!=0&&ve(e.value.projectName,e.value.branch).then(_=>{if(_.success){const b=_.data;!a||b.includes(a)?l([{label:_.data,value:_.data}]):l([])}else v.error(_.msg)}).catch(_=>{v.error(_)})}ce(()=>e.value.projectName,()=>{e.value.branch="",e.value.tag="",p.value=[],j=0-W,he(e.value.projectName),M(k.value)});const s=g(!1);async function c(a){a&&await a.validate(async(l,h)=>{if(l){s.value=!0,await je(500);const _=await oe(e.value);s.value=!1,_.success?(T.set(S,_.data),v.success("请求打包转测成功")):v.error(_.msg)}else console.log("error submit!",h)})}return(a,l)=>{const h=i("el-icon"),_=i("el-tooltip"),b=i("el-option"),n=i("el-select"),I=i("el-form-item"),G=i("el-autocomplete"),q=i("el-input"),K=i("el-space"),Y=i("el-button"),J=i("el-form");return r(),N("div",null,[d("div",null,[Re,t(_,{placement:"bottom",effect:"light"},{content:o(()=>[R(" 以当前项目的上一个yaml作为模板，只更新tag信息"),Ce,R(" 生成的yaml会放到update_yyMMdd文件夹下的yaml文件夹内"),Te,R(" 提交的更新说明内容会尾追加到update_yyMMdd文件夹的《更新说明.txt》文件内"),Se,R(" 如果不存在上述文件夹或文件则会新建 ")]),default:o(()=>[t(h,{color:"#E6A23C"},{default:o(()=>[t(V(ue))]),_:1})]),_:1})]),t(J,{model:e.value,"label-width":"auto",ref_key:"ruleFormRef",ref:m,rules:D.value},{default:o(()=>[t(I,{label:"项目名",prop:"projectName"},{default:o(()=>[t(n,{modelValue:e.value.projectName,"onUpdate:modelValue":l[0]||(l[0]=u=>e.value.projectName=u),clearable:"",filterable:"",placeholder:"请选择项目"},{default:o(()=>[(r(!0),N(C,null,U(k.value,u=>(r(),f(b,{key:u.label,value:u.value,disabled:u.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"分支",prop:"branch"},{default:o(()=>[t(n,{modelValue:e.value.branch,"onUpdate:modelValue":l[1]||(l[1]=u=>e.value.branch=u),clearable:"",filterable:"",onVisibleChange:B,disabled:e.value.projectName==null||e.value.projectName=="",loading:w.value,placeholder:"请选择项目分支"},{loading:o(()=>[t(h,{class:"is-loading"},{default:o(()=>[t(we)]),_:1})]),default:o(()=>[(r(!0),N(C,null,U(p.value,u=>(r(),f(b,{key:u.label,value:u.value,disabled:u.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue","disabled","loading"])]),_:1}),t(I,{label:"Tag",prop:"tag"},{default:o(()=>[t(G,{modelValue:e.value.tag,"onUpdate:modelValue":l[2]||(l[2]=u=>e.value.tag=u),clearable:"","fetch-suggestions":z,debounce:500,disabled:e.value.projectName==null||e.value.projectName.length===0||e.value.branch==null||e.value.branch.length===0},{loading:o(()=>[Ee]),_:1},8,["modelValue","disabled"])]),_:1}),t(I,{label:"更新说明"},{default:o(()=>[t(q,{modelValue:e.value.updateInfo,"onUpdate:modelValue":l[3]||(l[3]=u=>e.value.updateInfo=u),type:"textarea",placeholder:"请输入更新说明",autosize:{minRows:2,maxRows:4}},null,8,["modelValue"])]),_:1}),d("div",Fe,[t(Y,{size:"large",onClick:l[4]||(l[4]=u=>c(m.value)),loading:s.value},{default:o(()=>[t(K,{size:"small"},{default:o(()=>[t(xe,{width:22,height:22}),Pe]),_:1})]),_:1},8,["loading"])])]),_:1},8,["model","rules"])])}}}),Me=me(Ue,[["__scopeId","data-v-6043e987"]]),Xe=E({__name:"DeveloperTransfer",setup(L){const e=g(null);setInterval(()=>{const m=T.get(S);D(m,S)},be);async function D(m,k){if(m!=null){const p=await ye(m);p.success?(e.value=p.data,p.data==null&&T.remove(k)):v.error(p.msg)}}return(m,k)=>{const p=i("el-col"),w=i("el-row"),j=i("el-container"),B=i("el-aside"),z=i("el-main");return r(),f(j,null,{default:o(()=>[t(B,{width:"30%"},{default:o(()=>[t(w,null,{default:o(()=>[t(p,{span:18},{default:o(()=>[t(Me)]),_:1})]),_:1}),t(j,{style:{"margin-top":"15%"}},{default:o(()=>[e.value?(r(),f(Ne,{key:0,progress:e.value},null,8,["progress"])):x("",!0)]),_:1})]),_:1}),t(z,{style:{"margin-left":"10%"}},{default:o(()=>[t(Ae)]),_:1})]),_:1})}}});export{Xe as default};
