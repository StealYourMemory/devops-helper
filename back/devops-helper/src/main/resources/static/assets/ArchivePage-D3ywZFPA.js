import{g as U,a as j,k as J,f as K,_ as Y,b as G,l as H,c as Q,d as X,e as Z,h as ee,i as te}from"./byteFormatter-CuudNSZ-.js";import{d as le,j as g,s as ne,E as f,x as se,o as a,c as w,f as e,w as l,A as E,r as i,F as oe,l as ae,m as h,S as ie,n as y,C as ce,a as o,g as u,J as re,z as v,K as ue,t as b,L as _e,O as de}from"./index-B8KVQuq1.js";import{t as fe}from"./time-DxmJvrj7.js";import"./axios-CEz4Hwn_.js";const me=o("span",null,"生成归档",-1),he=o("strong",null,"yaml",-1),pe=o("strong",null,"sql",-1),ge=o("strong",null,"shell",-1),ye=o("strong",null,"合入需求",-1),ve=o("br",null,null,-1),ke=o("strong",null,"如果存在final-dh会删除之前的内容，所以如果原final-dh存在重要文件，请先备份！！！",-1),we=o("br",null,null,-1),be=o("br",null,null,-1),xe={key:0},Le={key:1,style:{"font-size":"medium","margin-left":"20px"}},ze={style:{"font-size":"medium"}},Ce={style:{"margin-left":"auto","margin-right":"20%",display:"flex"}},Ee={key:0,style:{"margin-right":"200px"}},Ve={style:{"font-size":"small"}},Be={style:{"font-size":"small"}},r=28,Te=le({__name:"ArchivePage",setup(Me){const _=g(""),V=g([]),x=g([]),$={label:"name",children:"children",isLeaf:"isLeaf"};let p="";ne(async()=>{const n=await U();n.success?p=n.data:f.error(n.msg);const t=await j(p);t.success?V.value=t.data.map(d=>d.name):f.error(t.msg)}),se(_,B);async function B(){if(!_.value)x.value=[];else{const n=E.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=await J(p+"/"+_.value);n.close(),t.success?x.value=t.data:f.error(t.msg)}}const L=g(!1),M=g(""),D=g("");async function A(n,t){if(t.size!=null&&Number(t.size)>10*1024*1024){f.warning("文件大于10MB，可能不是文本文件，不能查看");return}const d=E.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),m=await G(F(n));d.close(),m.success?(D.value=n.label.split(".")[1],M.value=m.data,L.value=!0):f.error(m.msg)}function F(n){if(n.level===0)return p;{const t=[];for(;n&&n.label;)t.unshift(n.label),n=n.parent;let d="";return t.forEach(m=>{d+=`/${m}`}),p+"/"+_.value+d}}async function S(){if(!_.value){f.warning("请先选择要归档的版本");return}de.confirm("原final-dh目录下的所有内容会删除，确认归档?",{confirmButtonText:"是",cancelButtonText:"取消",type:"warning"}).then(async()=>{const n=E.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=await H(p+"/"+_.value);n.close(),t.success?f.success("归档成功"):f.error("归档失败:"+t.msg)})}return(n,t)=>{const d=i("el-option"),m=i("el-select"),z=i("el-form-item"),k=i("el-icon"),C=i("el-button"),T=i("el-tooltip"),N=i("el-space"),W=i("el-form"),R=i("el-header"),O=i("el-tree"),q=i("el-main"),I=i("el-container"),P=i("el-dialog");return a(),w("div",null,[e(I,null,{default:l(()=>[e(R,null,{default:l(()=>[e(W,{inline:""},{default:l(()=>[e(z,{label:"迭代版本"},{default:l(()=>[e(m,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=c=>_.value=c),clearable:"",placeholder:"请选择迭代版本",style:{width:"200px"}},{default:l(()=>[(a(!0),w(oe,null,ae(V.value,c=>(a(),u(d,{key:c,value:c},null,8,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(z,null,{default:l(()=>[e(N,{size:"large"},{default:l(()=>[e(C,{type:"warning",onClick:S},{default:l(()=>[e(k,null,{default:l(()=>[e(h(ie))]),_:1}),me]),_:1}),e(T,{placement:"bottom",effect:"light"},{content:l(()=>[y(" 会归档本次迭代的"),he,y("、"),pe,y("、"),ge,y("和"),ye,ve,y(" 归档内容会放入final-dh目录，如果不存在会新建，"),ke,we,y(" 合入需求查的是devops的需求列表，需要seafile迭代目录包含yyyy年MM，devops的迭代目录包含yy年MM或者yyyy年MM"),be]),default:l(()=>[e(k,{color:"#E6A23C"},{default:l(()=>[e(h(ce))]),_:1})]),_:1})]),_:1})]),_:1}),e(z,null,{default:l(()=>[e(C,{icon:"refresh",onClick:B})]),_:1})]),_:1})]),_:1}),e(q,null,{default:l(()=>[e(O,{props:$,data:x.value},{default:l(({node:c,data:s})=>[o("div",null,[!c.expanded&&!s.isLeaf?(a(),u(k,{key:0,size:20},{default:l(()=>[e(h(re))]),_:1})):v("",!0),c.expanded&&!s.isLeaf?(a(),u(k,{key:1,size:20},{default:l(()=>[e(h(ue))]),_:1})):v("",!0)]),s.isLeaf?(a(),w("div",xe,[s.name.endsWith(".yaml")||s.name.endsWith(".yml")?(a(),u(Q,{key:0,width:r,height:r})):s.name.endsWith(".sql")?(a(),u(X,{key:1,width:r,height:r})):s.name.endsWith(".sh")?(a(),u(Z,{key:2,width:r,height:r})):s.name.endsWith(".txt")?(a(),u(ee,{key:3,width:r,height:r})):(a(),u(te,{key:4,width:r,height:r}))])):v("",!0),s.isLeaf?v("",!0):(a(),w("span",Le,b(s.name),1)),s.isLeaf?(a(),u(C,{key:2,text:"",size:"small",onClick:De=>A(c,s)},{default:l(()=>[o("span",ze,b(s.name),1)]),_:2},1032,["onClick"])):v("",!0),o("div",Ce,[s.isLeaf?(a(),w("div",Ee,[o("span",Ve,b(h(K)(s.size)),1)])):v("",!0),o("div",null,[e(k,null,{default:l(()=>[e(h(_e))]),_:1}),o("span",Be,b(h(fe)(s.time*1e3)),1)])])]),_:1},8,["data"])]),_:1})]),_:1}),e(P,{modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=c=>L.value=c),center:"",draggable:"","destroy-on-close":"",width:"80%"},{default:l(()=>[e(Y,{content:M.value,"file-type":D.value},null,8,["content","file-type"])]),_:1},8,["modelValue"])])}}});export{Te as default};
