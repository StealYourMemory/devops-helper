import{g as se,a as je,b as we,c as Ne,d as De,e as Pe}from"./projectApi-DNyIEPDE.js";import{D as le,B as M,p as K,a as ce,b as ae,c as Ae,L as E,d as X,e as Ve,f as ue,g as Ie,h as Z,i as re,j as ze,k as ee,t as Ue,l as Te}from"./projectWeight-D633_mfl.js";import{p as Ee,_ as ie,a as Re,b as Fe,d as Ge,c as Ye,e as Me,f as He,g as he,h as Ke}from"./BuildAndDeployProgress.vue_vue_type_style_index_0_lang-Dx6VpVzU.js";import{d as Y,o as i,c as I,a as p,v as Qe,j as u,x as J,s as Q,E as f,y as de,e as ke,r as s,f as a,w as l,F as R,l as G,g as C,z as F,n as w,t as O,m as A,A as xe,p as pe,h as _e,_ as me,B as We,C as qe,D as Je,G as ye,H as Xe}from"./index-B8KVQuq1.js";import{L as $e}from"./LoadingIcon-BIsLc0kW.js";import{s as oe}from"./sleeep-DLQXQLPT.js";import{t as ve}from"./time-DxmJvrj7.js";import"./axios-CEz4Hwn_.js";const Ze=["width","height"],el=p("path",{d:"M732 345c-5-1.3-10 1.3-13.8 3.8L657.9 409 614 365l60.3-60.3c3.8-3.8 5-8.8 3.8-13.8-1.3-5-3.8-8.8-8.8-11.3-59-28.9-130.6-16.3-177 30.1-35.1 35.1-51.5 84.1-43.9 133.1l-18.8 17.6c-6.3 6.3-6.3 16.3 0 22.6 6.3 6.3 16.3 6.3 22.6 0l23.8-23.8c3.8-3.8 5-8.8 3.8-13.8-8.8-41.4 5-84.1 33.9-113 31.4-31.4 77.8-43.9 121.8-32.6l-54 54c-6.3 6.3-6.3 16.3 0 22.6l66.5 66.5c6.3 6.3 16.3 6.3 22.6 0l54-54c11.3 42.7 0 89.1-32.6 121.8-30.1 30.1-71.6 42.7-113 33.9-5-1.3-10 0-13.8 3.8L408.1 704c-23.9 23.8-64 23.8-89.1 0-25.1-23.9-23.8-64 0-89.1l67.8-66.5c6.3-6.3 6.3-16.3 0-22.6-6.3-6.3-16.3-6.3-22.6 0l-66.5 66.5c-36.4 37.7-36.4 96.7 0 133.1 18.8 18.8 42.7 27.6 66.5 27.6 23.8 0 47.7-8.8 66.5-27.6L580.1 576c49 7.5 97.9-8.8 133.1-43.9 46.4-46.4 59-118 30.1-178.3-1.3-5.1-6.3-8.8-11.3-8.8z m0 0",fill:"#333333","p-id":"4623"},null,-1),ll=p("path",{d:"M351.2 624.4c-6.3 6.3-9.9 15.3-9.9 24.3s3.6 17.1 9.9 24.3c6.3 6.3 15.3 9.9 24.3 9.9s17.1-3.6 24.3-9.9c6.3-6.3 9.9-14.4 9.9-24.3s-3.6-17.1-9.9-24.3c-6.3-6.3-15.3-9.9-24.3-9.9s-18 3.6-24.3 9.9z m35.1 23.4c0 2.7-0.9 5.4-3.6 8.1-4.5 4.5-11.7 4.5-16.2 0-1.8-1.8-3.6-4.5-3.6-8.1s0.9-5.4 3.6-8.1c1.8-1.8 4.5-3.6 8.1-3.6 3.6 0 5.4 0.9 8.1 3.6 2.7 2.7 3.6 5.4 3.6 8.1z m0 0M747 554.6c-8.8-2.5-17.6 2.5-18.8 11.3-25.1 90.4-104.2 154.4-197.1 160.7-8.8 0-15.1 7.5-15.1 16.3s7.5 15.1 15.1 15.1h1.3c106.7-7.5 197.1-80.3 226-183.3 2.5-8.8-2.6-17.6-11.4-20.1z m-450.6-47.7c0-99.2 66.5-185.8 161.9-212.1 8.8-2.5 13.8-11.3 11.3-18.8-2.5-8.8-11.3-13.8-18.8-11.3C341.6 294.7 265 393.9 265 506.9c0 8.8 7.5 16.3 16.3 16.3s15.1-7.5 15.1-16.3z m0 0",fill:"#333333","p-id":"4624"},null,-1),al=p("path",{d:"M512 1012c-275.7 0-500-224.3-500-500S236.3 12 512 12s500 224.3 500 500-224.3 500-500 500z m0-957.6C259.7 54.4 54.4 259.7 54.4 512S259.7 969.6 512 969.6 969.6 764.3 969.6 512 764.3 54.4 512 54.4z",fill:"#333333","p-id":"4625"},null,-1),tl=[el,ll,al],ol=Y({__name:"PackageAndDeployIcon",props:{width:{default:24},height:{default:24}},setup(r){return(e,V)=>(i(),I("svg",{t:"1715179087642",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4622",width:e.width,height:e.height},tl,8,Ze))}}),ne=Qe("deployProjectInfo",{state:()=>({projectName:"",branch:"",environment:"",tag:""}),actions:{setDeployProject(r){this.projectName=r.projectName,this.branch=r.branch||"",this.tag=r.tag,this.environment=r.environment||""},clear(){this.projectName="",this.branch="",this.environment="",this.tag=""}}});class te{static set(e,V){sessionStorage.setItem(e,V)}static get(e){return sessionStorage.getItem(e)}static remove(e){sessionStorage.removeItem(e)}static clear(){sessionStorage.clear()}}const H=u(te.get(le)||M);function nl(r){te.set(le,r.paneName),H.value=r.paneName}const Se=[];function fe(r){Se.push(r)}J(H,()=>{Se.forEach(r=>r(H.value))});const ge=r=>(pe("data-v-e3f9bba6"),r=r(),_e(),r),sl=ge(()=>p("svg",{class:"circular",viewBox:"0 0 50 50"},[p("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)),cl={style:{display:"flex","justify-content":"flex-end","margin-right":"10px","margin-top":"40px"}},ul=ge(()=>p("span",null,"打包部署",-1)),rl=ge(()=>p("div",{class:"cell-item"}," 分支 ",-1)),il=Y({__name:"BuildAndDeploy",setup(r){const e=u({projectName:"",branch:"",environment:"",tag:""}),V=u(Ee),x=u(),N=u([]);Q(async()=>{const c=await se();if(c.success){const n=c.data.map(y=>({label:y.projectName,value:y.projectName,disabled:y.disabled}));K(n),N.value=n}else f.error(c.msg)});const h=u([]),$=u(!1);let g=0;async function L(){if(Date.now()-g>ae||h.value.length===0){$.value=!0;const c=await we(e.value.projectName);$.value=!1,g=Date.now(),c.success?h.value=c.data.branches.map(n=>({label:n,value:n})):f.error(c.msg)}}const S=u([]);Q(async()=>{const c=await je();c.success?S.value=c.data.map(n=>({label:n.envDescription,value:n.envName,disabled:n.serverSet==null||n.serverSet.length==0})):f.error(c.msg)});function P(c,n){e.value.projectName!=null&&e.value.projectName.length!=0&&e.value.branch!=null&&e.value.branch.length!=0&&Ne(e.value.projectName,e.value.branch).then(j=>{if(j.success){const U=j.data;!c||U.includes(c)?n([{label:j.data,value:j.data}]):n([])}else f.error(j.msg)}).catch(j=>{f.error(j)})}const B=ne();fe(c=>{c===M&&B.setDeployProject(e.value)}),de(()=>{B.clear()}),J(()=>e.value.projectName,()=>{e.value.branch="",e.value.tag="",h.value=[],g=0-ae,B.setDeployProject(e.value),ce(e.value.projectName),K(N.value)});const z=u(!1);async function b(c){c&&await c.validate(async(n,y)=>{if(n){z.value=!0,await oe(500);const j=await Ae(e.value);z.value=!1,j.success?(E.set(X,j.data),f.success("请求打包和部署成功")):f.error(j.msg)}else console.log("error submit!",y)})}const t=u(!1),o=u(),d=ke(()=>e.value.projectName&&e.value.environment);async function _(){const c=xe.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),n=await Ve(e.value.environment,e.value.projectName);c.close(),n.success?(o.value=n.data,t.value=!0):f.error(n.msg)}return(c,n)=>{const y=s("el-option"),j=s("el-select"),U=s("el-form-item"),D=s("el-icon"),T=s("el-button"),W=s("el-tooltip"),k=s("el-autocomplete"),m=s("el-space"),Ce=s("el-form"),q=s("el-descriptions-item"),Le=s("el-descriptions"),Oe=s("el-dialog");return i(),I(R,null,[p("div",null,[a(Ce,{model:e.value,"label-width":"auto",ref_key:"ruleFormRef",ref:x,rules:V.value},{default:l(()=>[a(U,{label:"项目名",prop:"projectName"},{default:l(()=>[a(j,{modelValue:e.value.projectName,"onUpdate:modelValue":n[0]||(n[0]=v=>e.value.projectName=v),clearable:"",filterable:"",placeholder:"请选择项目"},{default:l(()=>[(i(!0),I(R,null,G(N.value,v=>(i(),C(y,{key:v.label,value:v.value,disabled:v.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(U,{label:"分支",prop:"branch"},{default:l(()=>[a(j,{modelValue:e.value.branch,"onUpdate:modelValue":n[1]||(n[1]=v=>e.value.branch=v),clearable:"",filterable:"",onVisibleChange:L,disabled:e.value.projectName==null||e.value.projectName=="",loading:$.value,placeholder:"请选择项目分支"},{loading:l(()=>[a(D,{class:"is-loading"},{default:l(()=>[a($e)]),_:1})]),default:l(()=>[(i(!0),I(R,null,G(h.value,v=>(i(),C(y,{key:v.label,value:v.value,disabled:v.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue","disabled","loading"])]),_:1}),a(U,{label:"环境",prop:"environment"},{default:l(()=>[a(j,{modelValue:e.value.environment,"onUpdate:modelValue":n[2]||(n[2]=v=>e.value.environment=v),filterable:"",clearable:"",placeholder:"请选择环境"},{default:l(()=>[(i(!0),I(R,null,G(S.value,v=>(i(),C(y,{key:v.label,value:v.value,label:v.label,disabled:v.disabled},null,8,["value","label","disabled"]))),128))]),_:1},8,["modelValue"]),d.value?(i(),C(W,{key:0,content:"当前正运行情况",placement:"bottom",effect:"light"},{default:l(()=>[a(T,{text:"",onClick:_},{default:l(()=>[a(ie,{width:30,height:30})]),_:1})]),_:1})):F("",!0)]),_:1}),a(U,{label:"Tag",prop:"tag"},{default:l(()=>[a(k,{modelValue:e.value.tag,"onUpdate:modelValue":n[3]||(n[3]=v=>e.value.tag=v),clearable:"","fetch-suggestions":P,debounce:500,disabled:e.value.projectName==null||e.value.projectName.length===0||e.value.branch==null||e.value.branch.length===0},{loading:l(()=>[sl]),_:1},8,["modelValue","disabled"])]),_:1}),p("div",cl,[a(T,{size:"large",onClick:n[4]||(n[4]=v=>b(x.value)),loading:z.value},{default:l(()=>[a(m,{size:"small"},{default:l(()=>[a(ol,{width:22,height:22}),ul]),_:1})]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),a(Oe,{modelValue:t.value,"onUpdate:modelValue":n[5]||(n[5]=v=>t.value=v),center:"",draggable:"","destroy-on-close":"",style:{"border-radius":"15px"},width:"30%"},{header:l(()=>[w(" 当前环境正运行信息： ")]),default:l(()=>[a(Le,{border:"",column:1},{default:l(()=>[a(q,null,{label:l(()=>[w(" 环境 ")]),default:l(()=>[w(" "+O(S.value.find(v=>v.value==e.value.environment).label),1)]),_:1}),a(q,null,{label:l(()=>[w(" 项目名 ")]),default:l(()=>[w(" "+O(o.value.projectName),1)]),_:1}),a(q,null,{label:l(()=>[w(" Tag ")]),default:l(()=>[w(" "+O(o.value.tag),1)]),_:1}),a(q,null,{label:l(()=>[rl]),default:l(()=>[w(" "+O(o.value.branch),1)]),_:1}),a(q,null,{label:l(()=>[w(" 打包时间 ")]),default:l(()=>[w(" "+O(A(ve)(o.value.date)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),dl=me(il,[["__scopeId","data-v-e3f9bba6"]]),Be=r=>(pe("data-v-5725f1ec"),r=r(),_e(),r),pl=Be(()=>p("svg",{class:"circular",viewBox:"0 0 50 50"},[p("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)),_l={style:{display:"flex","justify-content":"flex-end","margin-right":"10px","margin-top":"40px"}},ml=Be(()=>p("span",null,"仅打包",-1)),vl=Y({__name:"BuildOnly",setup(r){const e=u({projectName:"",branch:"",tag:""}),V=u(Re),x=u(),N=u([]);Q(async()=>{const b=await se();if(b.success){const t=b.data.map(o=>({label:o.projectName,value:o.projectName,disabled:o.disabled}));K(t),N.value=t}else f.error(b.msg)});const h=u([]),$=u(!1);let g=0;async function L(){if(Date.now()-g>ae||h.value.length===0){$.value=!0;const b=await we(e.value.projectName);$.value=!1,g=Date.now(),b.success?h.value=b.data.branches.map(t=>({label:t,value:t})):f.error(b.msg)}}function S(b,t){e.value.projectName!=null&&e.value.projectName.length!=0&&e.value.branch!=null&&e.value.branch.length!=0&&Ne(e.value.projectName,e.value.branch).then(d=>{if(d.success){const _=d.data;!b||_.includes(b)?t([{label:d.data,value:d.data}]):t([])}else f.error(d.msg)}).catch(d=>{f.error(d)})}const P=ne();fe(b=>{b===ue&&P.setDeployProject(e.value)}),de(()=>{P.clear()}),J(()=>e.value.projectName,()=>{e.value.branch="",e.value.tag="",h.value=[],g=0-ae,P.setDeployProject(e.value),ce(e.value.projectName),K(N.value)});const B=u(!1);async function z(b){b&&await b.validate(async(t,o)=>{if(t){B.value=!0,await oe(500);const d=await Ie(e.value);B.value=!1,d.success?(E.set(Z,d.data),f.success("请求打包成功")):f.error(d.msg)}else console.log("error submit!",o)})}return(b,t)=>{const o=s("el-option"),d=s("el-select"),_=s("el-form-item"),c=s("el-icon"),n=s("el-autocomplete"),y=s("el-space"),j=s("el-button"),U=s("el-form");return i(),I("div",null,[a(U,{model:e.value,"label-width":"auto",ref_key:"ruleFormRef",ref:x,rules:V.value},{default:l(()=>[a(_,{label:"项目名",prop:"projectName"},{default:l(()=>[a(d,{modelValue:e.value.projectName,"onUpdate:modelValue":t[0]||(t[0]=D=>e.value.projectName=D),clearable:"",filterable:"",placeholder:"请选择项目"},{default:l(()=>[(i(!0),I(R,null,G(N.value,D=>(i(),C(o,{key:D.label,value:D.value,disabled:D.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"分支",prop:"branch"},{default:l(()=>[a(d,{modelValue:e.value.branch,"onUpdate:modelValue":t[1]||(t[1]=D=>e.value.branch=D),clearable:"",filterable:"",onVisibleChange:L,disabled:e.value.projectName==null||e.value.projectName=="",loading:$.value,placeholder:"请选择项目分支"},{loading:l(()=>[a(c,{class:"is-loading"},{default:l(()=>[a($e)]),_:1})]),default:l(()=>[(i(!0),I(R,null,G(h.value,D=>(i(),C(o,{key:D.label,value:D.value,disabled:D.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue","disabled","loading"])]),_:1}),a(_,{label:"Tag",prop:"tag"},{default:l(()=>[a(n,{modelValue:e.value.tag,"onUpdate:modelValue":t[2]||(t[2]=D=>e.value.tag=D),clearable:"","fetch-suggestions":S,debounce:500,disabled:e.value.projectName==null||e.value.projectName.length===0||e.value.branch==null||e.value.branch.length===0},{loading:l(()=>[pl]),_:1},8,["modelValue","disabled"])]),_:1}),p("div",_l,[a(j,{size:"large",onClick:t[3]||(t[3]=D=>z(x.value)),loading:B.value},{default:l(()=>[a(y,{size:"small"},{default:l(()=>[a(Fe,{width:22,height:22}),ml]),_:1})]),_:1},8,["loading"])])]),_:1},8,["model","rules"])])}}}),fl=me(vl,[["__scopeId","data-v-5725f1ec"]]),gl=["width","height"],bl=p("path",{d:"M766.1 880.9L539.5 769.8c-16.9-8.3-24-28.7-15.7-45.7 4-8.1 11-14.3 19.5-17.3 8.6-2.9 17.9-2.4 26.1 1.6l185.8 91.2 80.2-549.1-361.2 433.4v201.4c0 18.8-15.3 34.1-34.1 34.1S406 904.1 406 885.3V672.7c0-1.8 0.1-3.5 0.4-5.3 0.8-6.6 3.5-12.9 7.7-18L754.4 241 208.8 524.1l128.6 66.7c16.9 8.9 23.6 29.5 15.3 46.6-3.8 7.9-10.7 13.9-19 16.8-8.3 2.9-17.4 2.3-25.3-1.5l-186-96.8c-7.1-3.7-12.7-9.7-15.9-17-4.2-7.9-5.1-17.2-2.5-25.7 2.6-8.6 8.5-15.8 16.5-20l749.6-388.9c5-2.6 10.6-3.9 16.2-3.9 16.7-0.3 31.1 11.5 34.1 27.9 1.1 5.5 0.9 11.1-0.6 16.5L816.1 854.9c-2.2 15.4-14.3 26.8-28.9 29-7.2 1.3-14.6 0.3-21.1-3z m0 0","p-id":"12425"},null,-1),hl=[bl],yl=Y({__name:"DeployOnlyIcon",props:{width:{default:24},height:{default:24}},setup(r){return(e,V)=>(i(),I("svg",{t:"1715181761966",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"12424",width:e.width,height:e.height},hl,8,gl))}}),be=r=>(pe("data-v-34abf3be"),r=r(),_e(),r),jl=be(()=>p("svg",{class:"circular",viewBox:"0 0 50 50"},[p("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)),wl={style:{display:"flex","justify-content":"flex-end","margin-right":"10px","margin-top":"40px"}},Nl=be(()=>p("span",null,"仅部署",-1)),Dl=be(()=>p("div",{class:"cell-item"}," 分支 ",-1)),Vl=Y({__name:"DeployOnly",setup(r){const e=u({projectName:"",environment:"",tag:""}),V=u(Ge),x=u(),N=u([]);Q(async()=>{const t=await se();if(t.success){const o=t.data.map(d=>({label:d.projectName,value:d.projectName,disabled:d.disabled}));K(o),N.value=o}else f.error(t.msg)});const h=u([]);Q(async()=>{const t=await je();t.success?h.value=t.data.map(o=>({label:o.envDescription,value:o.envName,disabled:o.serverSet==null||o.serverSet.length==0})):f.error(t.msg)});function $(t,o){e.value.projectName!=null&&e.value.projectName.length!=0&&De(e.value.projectName).then(_=>{if(_.success){const c=_.data.map(n=>({label:n.tag,value:n.tag,branch:n.branch}));o(t?c.filter(n=>n.value.includes(t)):c)}else f.error(_.msg)}).catch(_=>{f.error(_)})}const g=ne();fe(t=>{t===re&&g.setDeployProject(e.value)}),de(()=>{g.clear()}),J(()=>e.value.projectName,()=>{e.value.tag="",g.setDeployProject(e.value),ce(e.value.projectName),K(N.value)});const L=u(!1);async function S(t){t&&await t.validate(async(o,d)=>{if(o){L.value=!0,await oe(500);const _=await ze(e.value);L.value=!1,_.success?(E.set(ee,_.data),f.success("请求部署成功")):f.error(_.msg)}else console.log("error submit!",d)})}const P=u(!1),B=u(),z=ke(()=>e.value.projectName&&e.value.environment);async function b(){const t=xe.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),o=await Ve(e.value.environment,e.value.projectName);t.close(),o.success?(B.value=o.data,P.value=!0):f.error(o.msg)}return(t,o)=>{const d=s("el-option"),_=s("el-select"),c=s("el-form-item"),n=s("el-button"),y=s("el-tooltip"),j=s("el-autocomplete"),U=s("el-space"),D=s("el-form"),T=s("el-descriptions-item"),W=s("el-descriptions"),k=s("el-dialog");return i(),I(R,null,[p("div",null,[a(D,{model:e.value,"label-width":"auto",ref_key:"ruleFormRef",ref:x,rules:V.value},{default:l(()=>[a(c,{label:"项目名",prop:"projectName"},{default:l(()=>[a(_,{modelValue:e.value.projectName,"onUpdate:modelValue":o[0]||(o[0]=m=>e.value.projectName=m),clearable:"",filterable:"",placeholder:"请选择项目"},{default:l(()=>[(i(!0),I(R,null,G(N.value,m=>(i(),C(d,{key:m.label,value:m.value,disabled:m.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"环境",prop:"environment"},{default:l(()=>[a(_,{modelValue:e.value.environment,"onUpdate:modelValue":o[1]||(o[1]=m=>e.value.environment=m),filterable:"",clearable:"",placeholder:"请选择环境"},{default:l(()=>[(i(!0),I(R,null,G(h.value,m=>(i(),C(d,{key:m.label,value:m.value,label:m.label,disabled:m.disabled},null,8,["value","label","disabled"]))),128))]),_:1},8,["modelValue"]),z.value?(i(),C(y,{key:0,content:"当前正运行情况",placement:"bottom",effect:"light"},{default:l(()=>[a(n,{text:"",onClick:b},{default:l(()=>[a(ie,{width:30,height:30})]),_:1})]),_:1})):F("",!0)]),_:1}),a(c,{label:"Tag",prop:"tag"},{default:l(()=>[a(j,{modelValue:e.value.tag,"onUpdate:modelValue":o[2]||(o[2]=m=>e.value.tag=m),clearable:"","fetch-suggestions":$,debounce:500,disabled:e.value.projectName==null||e.value.projectName.length===0},{loading:l(()=>[jl]),default:l(({item:m})=>[w(O(m.label)+" / "+O(m.branch),1)]),_:1},8,["modelValue","disabled"])]),_:1}),p("div",wl,[a(n,{size:"large",onClick:o[3]||(o[3]=m=>S(x.value)),loading:L.value},{default:l(()=>[a(U,{size:"small"},{default:l(()=>[a(yl,{width:22,height:22}),Nl]),_:1})]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),a(k,{modelValue:P.value,"onUpdate:modelValue":o[4]||(o[4]=m=>P.value=m),center:"",draggable:"","destroy-on-close":"",style:{"border-radius":"15px"},width:"30%"},{header:l(()=>[w(" 当前环境正运行信息： ")]),default:l(()=>[a(W,{border:"",column:1},{default:l(()=>[a(T,null,{label:l(()=>[w(" 环境 ")]),default:l(()=>[w(" "+O(h.value.find(m=>m.value==e.value.environment).label),1)]),_:1}),a(T,null,{label:l(()=>[w(" 项目名 ")]),default:l(()=>[w(" "+O(B.value.projectName),1)]),_:1}),a(T,null,{label:l(()=>[w(" Tag ")]),default:l(()=>[w(" "+O(B.value.tag),1)]),_:1}),a(T,null,{label:l(()=>[Dl]),default:l(()=>[w(" "+O(B.value.branch),1)]),_:1}),a(T,null,{label:l(()=>[w(" 打包时间 ")]),default:l(()=>[w(" "+O(A(ve)(B.value.date)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),kl=me(Vl,[["__scopeId","data-v-34abf3be"]]),xl=Y({__name:"CommonDeployForm",setup(r){return(e,V)=>{const x=s("el-tab-pane"),N=s("el-tabs"),h=s("el-container");return i(),C(h,null,{default:l(()=>[a(N,{type:"card",modelValue:A(H),"onUpdate:modelValue":V[0]||(V[0]=$=>We(H)?H.value=$:null),onTabClick:A(nl)},{default:l(()=>[a(x,{label:"打包+部署",name:A(M)},{default:l(()=>[a(dl)]),_:1},8,["name"]),a(x,{label:"仅打包",name:A(ue)},{default:l(()=>[a(fl)]),_:1},8,["name"]),a(x,{label:"仅部署",name:A(re)},{default:l(()=>[a(kl)]),_:1},8,["name"])]),_:1},8,["modelValue","onTabClick"])]),_:1})}}}),$l={key:0},Sl={style:{display:"flex","justify-content":"flex-end","margin-bottom":"2%"}},Bl={style:{display:"flex","justify-content":"flex-end"}},Cl={style:{"font-weight":"bold",color:"#303133","margin-left":"5px"}},Ll={style:{"font-weight":"bold"}},Ol={style:{"font-weight":"bold"}},Pl=p("span",{style:{"font-weight":"bold","vertical-align":"middle","margin-left":"10px"}},"控制台输出",-1),Al=Y({__name:"BuildHistory",setup(r){const e=ne(),V=u(""),x=u([]),N=u(!1);async function h(){N.value=!0,await oe(500),await $(),N.value=!1}async function $(){if(e.projectName){const t=await De(e.projectName,V.value);t.success?x.value=t.data:f.error(t.msg)}}Q(()=>{$()}),J(()=>e.projectName,$);function g(t){switch(t){case"Success":return"circleCheck";case"Failed":return"circleClose";case"Pending":return"loading";case"Aborted":return"circleClose"}}function L(t){switch(t){case"Success":return"#67C23A";case"Failed":return"#F56C6C";case"Pending":return"#409EFF";case"Aborted":return"#909399"}}function S(t){if(t==null)return"--";const o=Math.floor(t/60),d=t-o*60;let _="";return o>0&&(_+=`${o}分`),_+=`${d}秒`,_}const P=u(!1),B=u(""),z=u("Success");async function b(t){z.value=t.status;const o=await Pe(t.projectName,t.id);o.success?(B.value=o.data,P.value=!0):f.error(o.msg)}return(t,o)=>{const d=s("el-input"),_=s("el-button"),c=s("el-icon"),n=s("el-tooltip"),y=s("el-space"),j=s("el-card"),U=s("el-timeline-item"),D=s("el-timeline"),T=s("el-scrollbar"),W=s("el-dialog");return A(e).projectName?(i(),I("div",$l,[p("div",Sl,[a(y,{size:"small"},{default:l(()=>[a(d,{modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=k=>V.value=k),placeholder:"请输入筛选内容","prefix-icon":"search",onChange:$,clearable:""},null,8,["modelValue"]),a(_,{icon:"refresh",onClick:h,loading:N.value},null,8,["loading"]),a(n,{content:"仅支持按分支或tag筛选",placement:"bottom",effect:"light"},{default:l(()=>[a(c,{color:"#E6A23C"},{default:l(()=>[a(A(qe))]),_:1})]),_:1})]),_:1})]),p("div",Bl,[a(T,{height:"760"},{default:l(()=>[a(D,{style:{"margin-top":"1%"}},{default:l(()=>[(i(!0),I(R,null,G(x.value,k=>(i(),C(U,{key:k.id,timestamp:A(ve)(k.date,!1),placement:"top",icon:g(k.status),color:L(k.status)},{default:l(()=>[a(j,null,{default:l(()=>[a(y,{size:20,wrap:""},{default:l(()=>[a(n,{content:"详情",placement:"bottom",effect:"light"},{default:l(()=>[a(_,{text:"",onClick:m=>b(k)},{default:l(()=>[a(ie,{width:18,height:18}),p("span",Cl,O(`${k.id}`),1)]),_:2},1032,["onClick"])]),_:2},1024),a(y,{size:5},{default:l(()=>[a(Me,{width:18,height:18}),p("span",Ll,O(`${k.branch}`),1)]),_:2},1024),a(y,{size:5},{default:l(()=>[a(He,{width:18,height:18}),p("span",Ol,O(`${k.tag}`),1)]),_:2},1024),a(y,{size:5},{default:l(()=>[a(n,{content:"耗时",placement:"bottom",effect:"light"},{default:l(()=>[a(he,{width:18,height:18})]),_:1}),p("span",null,O(S(k.tookTime)),1)]),_:2},1024),k.status==="Pending"?(i(),C(y,{key:0,size:5},{default:l(()=>[a(n,{content:"预计剩余",placement:"bottom",effect:"light"},{default:l(()=>[a(he,{width:18,height:18})]),_:1}),p("span",null,O(S(k.remainingTime)),1)]),_:2},1024)):F("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["timestamp","icon","color"]))),128))]),_:1})]),_:1})]),a(W,{modelValue:P.value,"onUpdate:modelValue":o[1]||(o[1]=k=>P.value=k),center:"",draggable:"","destroy-on-close":"",style:{"border-radius":"15px"},width:"70%"},{header:l(()=>[p("div",null,[z.value==="Success"?(i(),C(c,{key:0,color:"#67C23A",size:"28",style:{"vertical-align":"middle"}},{default:l(()=>[a(A(Je))]),_:1})):F("",!0),z.value==="Failed"?(i(),C(c,{key:1,color:"#F56C6C",size:"28",style:{"vertical-align":"middle"}},{default:l(()=>[a(A(ye))]),_:1})):F("",!0),z.value==="Aborted"?(i(),C(c,{key:2,color:"#909399",size:"28",style:{"vertical-align":"middle"}},{default:l(()=>[a(A(ye))]),_:1})):F("",!0),z.value==="Pending"?(i(),C(c,{key:3,color:"#409EFF",size:"28",style:{"vertical-align":"middle"}},{default:l(()=>[a(A(Xe))]),_:1})):F("",!0),Pl])]),default:l(()=>[a(Ye,{content:B.value,style:{height:600,width:400,borderRadius:15,padding:0}},null,8,["content"])]),_:1},8,["modelValue"])])):F("",!0)}}}),Yl=Y({__name:"CommonDeploy",setup(r){const e=u(te.get(le)||M),V=u(E.get(X)),x=u(E.get(Z)),N=u(E.get(ee));setInterval(()=>{e.value=te.get(le)||M;let g,L;switch(e.value){case M:V.value=E.get(X),g=V.value,L=X;break;case ue:x.value=E.get(Z),g=x.value,L=Z;break;case re:N.value=E.get(ee),g=N.value,L=ee;break}$(g,L)},Ue);const h=u(null);async function $(g,L){if(g!=null){const S=await Te(g);S.success?(h.value=S.data,S.data==null&&E.remove(L)):f.error(S.msg)}}return(g,L)=>{const S=s("el-container"),P=s("el-aside"),B=s("el-main");return i(),C(S,null,{default:l(()=>[a(P,{width:"35%"},{default:l(()=>[a(xl),a(S,{style:{"margin-top":"15%"}},{default:l(()=>[h.value?(i(),C(Ke,{key:0,progress:h.value},null,8,["progress"])):F("",!0)]),_:1})]),_:1}),a(B,null,{default:l(()=>[a(Al)]),_:1})]),_:1})}}});export{Yl as default};
