import{g as T,a as U}from"./projectApi-DNyIEPDE.js";import{p as A,m as G}from"./projectWeight-D633_mfl.js";import{d as R}from"./debounce-BzScJiEs.js";import{t as W}from"./time-DxmJvrj7.js";import{d as q,j as d,s as g,E as i,A as z,x as H,o as p,g as h,w as t,r as n,f as e,c as x,l as j,F as k,m as V,I as J,n as D,t as L}from"./index-B8KVQuq1.js";import"./axios-CEz4Hwn_.js";const le=q({__name:"DeployInfo",setup(K){const s=d(""),r=d(""),y=d([]);g(async()=>{const o=await T();if(o.success){const a=o.data.map(c=>({label:c.projectName,value:c.projectName,disabled:c.disabled}));A(a),y.value=a}else i.error(o.msg)});const m=d([]);g(async()=>{const o=await U();o.success?m.value=o.data.map(a=>({label:a.envDescription,value:a.envName,disabled:!1})):i.error(o.msg)}),g(()=>{b()});const _=d(),f=d(!1);async function b(){if(!s.value&&!r.value){i.warning("请选择环境或项目"),_.value=[];return}const o=z.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});console.log("yhs-test:",s.value,r.value);const a=await G(s.value,r.value);o.close(),a.success?_.value=a.data:i.error(a.msg)}async function N(){f.value=!0,await b(),f.value=!1,i.success("刷新成功")}const E=R(b,500);return H([s,r],E,{deep:!0}),(o,a)=>{const c=n("el-option"),w=n("el-select"),v=n("el-form-item"),I=n("el-icon"),C=n("el-button"),B=n("el-form"),S=n("el-header"),u=n("el-table-column"),F=n("el-table"),M=n("el-main"),O=n("el-container");return p(),h(O,null,{default:t(()=>[e(S,null,{default:t(()=>[e(B,{inline:""},{default:t(()=>[e(v,{label:"环境"},{default:t(()=>[e(w,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value=l),filterable:"",clearable:"",placeholder:"请选择环境",style:{width:"200px"}},{default:t(()=>[(p(!0),x(k,null,j(m.value,l=>(p(),h(c,{key:l.label,value:l.value,label:l.label,disabled:l.disabled},null,8,["value","label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"项目"},{default:t(()=>[e(w,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value=l),clearable:"",filterable:"",placeholder:"请选择项目",style:{width:"200px"}},{default:t(()=>[(p(!0),x(k,null,j(y.value,l=>(p(),h(c,{key:l.label,value:l.value,disabled:l.disabled},null,8,["value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(C,{loading:f.value,onClick:N},{default:t(()=>[e(I,null,{default:t(()=>[e(V(J))]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(M,{style:{"margin-top":"2%"}},{default:t(()=>[e(F,{data:_.value,stripe:"","max-height":"500","table-layout":"fixed"},{default:t(()=>[e(u,{type:"index",label:"#"}),e(u,{label:"环境",align:"center","header-align":"center"},{default:t(l=>[D(L(m.value.find(P=>P.value==l.row.envName).label),1)]),_:1}),e(u,{prop:"projectName",label:"项目名",align:"center","header-align":"center"}),e(u,{prop:"branch",label:"分支",align:"center","header-align":"center"}),e(u,{prop:"tag",label:"Tag",align:"center","header-align":"center"}),e(u,{label:"时间",align:"center","header-align":"center"},{default:t(l=>[D(L(V(W)(l.row.date)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}});export{le as default};
