import{g as D,_ as $,t as z,s as O,d as G}from"./deleteSuggest-BzBIscJI.js";import{d as H,j as h,x as C,o as b,g as J,w as r,E as _,r as o,f as l,m as M,a as v,t as i,N as A,n as k,c as B,l as K,F as U,O as P,A as Q}from"./index-B8KVQuq1.js";import"./axios-CEz4Hwn_.js";import"./LoadingIcon-BIsLc0kW.js";const W=v("br",null,null,-1),ae=H({__name:"DevopsRequirement",setup(X){const d=h(""),f=h(""),p=h("ALL"),u=h([]);let c;C(d,E),C([p,f],y);async function E(){d.value&&D(d.value).then(e=>{e.success?(c=e.data,y()):_.error(e.msg)}).catch(e=>_.error(e))}function y(){switch(p.value){case"ALL":u.value=c;break;case"SUCCESS":u.value=c.filter(e=>g(e));break;case"FAIL":u.value=c.filter(e=>!g(e));break;default:u.value=c;break}f.value&&(u.value=u.value.filter(e=>L(e)))}function q(e,t){const s=[...new Set(S(c))].map(m=>({value:m})),w=e?s.filter(m=>m.value.includes(e)):s;t(w)}function S(e){let t=e.map(a=>a.assigneeName);for(const a of e)a.children!=null&&a.children.length>1&&(t=[...t,...S(a.children)]);return t}function g(e){if(e.success){if(e.children!=null&&e.children.length>1){for(let t of e.children)if(!g(t))return!1}}else return!1;return!0}function L(e){if(e.assigneeName.includes(f.value))return!0;if(e.children!=null&&e.children.length>1){for(let t of e.children)if(L(t))return!0}return!1}function F(e){switch(e){case"史诗":return"level_span epic";case"特性":return"level_span characteristic";case"用户故事":return"level_span user_stories";case"任务":return"level_span task";default:return"level_span"}}function T(e){switch(e){case"未开始":return"status_span unfinished";case"实现中":return"status_span implementing";case"已完成":return"status_span finished";case"已拒绝":return"status_span refused";default:return"status_span"}}async function j(){var t;const e=(t=u.value)==null?void 0:t.filter(a=>!g(a));if(e==null||e.length===0){_.warning("没有可通知的内容");return}P.confirm("确认发送邮件?",{confirmButtonText:"是",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a=Q.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),s=await O(e);a.close(),s.success?_.success("发送成功"):_.error("发送失败"+s.msg)})}return(e,t)=>{const a=o("el-header"),s=o("el-table-column"),w=o("el-button"),m=o("el-tooltip"),R=o("el-table"),I=o("el-main"),N=o("el-container");return b(),J(N,null,{default:r(()=>[l(a,null,{default:r(()=>[l($,{"sprint-model":d.value,"onUpdate:sprintModel":t[0]||(t[0]=n=>d.value=n),"status-model":p.value,"onUpdate:statusModel":t[1]||(t[1]=n=>p.value=n),"user-model":f.value,"onUpdate:userModel":t[2]||(t[2]=n=>f.value=n),onSendMail:j,onUserFetchSuggestion:q},null,8,["sprint-model","status-model","user-model"])]),_:1}),l(N,{style:{"margin-top":"1%"}},{default:r(()=>[l(I,null,{default:r(()=>[l(R,{data:u.value,"row-key":"key","default-expand-all":"","max-height":"660","row-class-name":M(z)},{default:r(()=>[l(s,{label:"级别","header-align":"center",align:"center",width:"160"},{default:r(n=>[v("span",{class:A(F(n.row.projectIssueTypeName))},i(n.row.projectIssueTypeName),3)]),_:1}),l(s,{label:"内容","header-align":"center"},{default:r(n=>[k(" ["+i(n.row.key)+"]"+i(n.row.subject),1)]),_:1}),l(s,{label:"状态",width:"120","header-align":"center",align:"center"},{default:r(n=>[v("span",{class:A(T(n.row.stateName))},i(n.row.stateName),3)]),_:1}),l(s,{label:"责任人",width:"120","header-align":"center",align:"center"},{default:r(n=>[k(i(n.row.assigneeName),1)]),_:1}),l(s,{label:"审查结果","header-align":"center"},{default:r(n=>[(b(!0),B(U,null,K(n.row.suggest,(V,x)=>(b(),B(U,{key:x},[l(m,{content:"删除审查建议",effect:"light"},{default:r(()=>[l(w,{icon:"warning-filled",type:"warning",text:"",onClick:Y=>M(G)(n.row,x)},null,8,["onClick"])]),_:2},1024),v("span",null,[k(i(V),1),W])],64))),128))]),_:1})]),_:1},8,["data","row-class-name"])]),_:1})]),_:1})]),_:1})}}});export{ae as default};
