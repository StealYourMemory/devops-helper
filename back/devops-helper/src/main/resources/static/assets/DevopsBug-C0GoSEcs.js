import{a as V,_ as j,t as D,s as R,d as $}from"./deleteSuggest-BzBIscJI.js";import{d as z,j as p,x,o as w,g as I,w as l,E as f,r as u,f as s,m as B,n as b,t as _,a as h,N as O,c as C,l as q,F as N,O as G,A as H}from"./index-B8KVQuq1.js";import"./axios-CEz4Hwn_.js";import"./LoadingIcon-BIsLc0kW.js";const J=h("br",null,null,-1),Z=z({__name:"DevopsBug",setup(K){const i=p(""),d=p(""),m=p("ALL"),o=p([]);let g;x(i,y),x([m,d],S);async function y(){i.value&&V(i.value).then(e=>{e.success?(g=e.data,S()):f.error(e.msg)}).catch(e=>f.error(e))}function S(){if(m.value)switch(m.value){case"ALL":o.value=g;break;case"SUCCESS":o.value=g.filter(e=>e.success);break;case"FAIL":o.value=g.filter(e=>!e.success);break}d.value&&(o.value=o.value.filter(e=>e.assigneeName.includes(d.value)))}function M(e,a){const n=[...new Set(g.map(r=>r.assigneeName))].map(r=>({value:r})),v=e?n.filter(r=>r.value.includes(e)):n;a(v)}async function A(){var a;const e=(a=o.value)==null?void 0:a.filter(c=>!c.success);if(e==null||e.length===0){f.warning("没有可通知的内容");return}G.confirm("确认发送邮件?",{confirmButtonText:"是",cancelButtonText:"取消",type:"warning"}).then(async()=>{const c=H.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),n=await R(e);c.close(),n.success?f.success("发送成功"):f.error("发送失败"+n.msg)})}function E(e){switch(e){case"未开始":return"status_span unfinished";case"实现中":return"status_span implementing";case"测试验证":return"status_span implementing";case"已完成":return"status_span finished";case"已拒绝":return"status_span refused";case"阻塞":return"status_span block";default:return"status_span"}}return(e,a)=>{const c=u("el-header"),n=u("el-table-column"),v=u("el-button"),r=u("el-tooltip"),U=u("el-table"),F=u("el-main"),k=u("el-container");return w(),I(k,null,{default:l(()=>[s(c,null,{default:l(()=>[s(j,{"sprint-model":i.value,"onUpdate:sprintModel":a[0]||(a[0]=t=>i.value=t),"status-model":m.value,"onUpdate:statusModel":a[1]||(a[1]=t=>m.value=t),"user-model":d.value,"onUpdate:userModel":a[2]||(a[2]=t=>d.value=t),onSendMail:A,onUserFetchSuggestion:M},null,8,["sprint-model","status-model","user-model"])]),_:1}),s(k,{style:{"margin-top":"1%"}},{default:l(()=>[s(F,null,{default:l(()=>[s(U,{data:o.value,"max-height":"660","row-class-name":B(D)},{default:l(()=>[s(n,{label:"内容","header-align":"center"},{default:l(t=>[b(" ["+_(t.row.key)+"]"+_(t.row.subject),1)]),_:1}),s(n,{label:"状态",width:"120","header-align":"center",align:"center"},{default:l(t=>[h("span",{class:O(E(t.row.stateName))},_(t.row.stateName),3)]),_:1}),s(n,{label:"责任人",width:"120","header-align":"center",align:"center"},{default:l(t=>[b(_(t.row.assigneeName),1)]),_:1}),s(n,{label:"审查结果","header-align":"center"},{default:l(t=>[(w(!0),C(N,null,q(t.row.suggest,(T,L)=>(w(),C(N,{key:L},[s(r,{content:"删除审查建议",effect:"light"},{default:l(()=>[s(v,{icon:"warning-filled",type:"warning",text:"",onClick:P=>B($)(t.row,L)},null,8,["onClick"])]),_:2},1024),h("span",null,[b(_(T),1),J])],64))),128))]),_:1})]),_:1},8,["data","row-class-name"])]),_:1})]),_:1})]),_:1})}}});export{Z as default};
